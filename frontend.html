<!DOCTYPE html>
<html>
    <head>
        <title>

        </title>
    </head>
    <body style="background-color:  indigo;">
        <div id="addBooks" style="color: black; background-color: orange;">
            Fill out the following dat to insert a new book into our db <br>
            Author => <input type="text" id="author" style="color:black; background-color: orangered; "> 
            Title => <input type="text" id="title" style="color:black; background-color: orangered; ">
            Genre => <select id="genre" style="color:black; background-color: orangered; ">
                <option value="Science fiction">Science fiction</option>
                <option value="Satire">Satire</option>
                <option value="Drama">Drama</option>
                <option value="Action and Adventure">Action and Adventure</option>
                <option value="Romance">Romance</option>
                <option value="Mystery">Mystery</option>
                <option value="Horror">Horror</option>
            </select>
            Price => <input type="text" id="price" style="color:black; background-color: orangered; ">
            <input type="button" id="addBook" value="Add Book" style="color:black; background-color: orangered; "> <br>
        </div>
        <br>
        <div id=searchbooks style="color: orangered; background-color: blue;">
            Write a keyword to find a book which containts it in it's title <br>
            Keyword => <input type="text" id="searchBook" style="color:black; background-color: orangered; " >
            <input type="button" id="getBooks" value="Get Books" style="color:black; background-color: orangered; ">
        </div>
        <br>
        <div id="text" style="color: greenyellow;" >id | author | title | genre | price</div>
        <div id="books" style="background-color: greenyellow;"></div>
    </body>
    <script type="text/Javascript">
        window.addEventListener('load',(event)=>
        {
            document.getElementById('addBook').addEventListener('click',(event)=>
            {
                const book= {
                    'author':document.getElementById('author').value,
                    'title':document.getElementById('title').value,
                    'genre':document.getElementById('genre').value,
                    'price':document.getElementById('price').value,
                };
                
                /**
                 * clearing the text boxes  
                 */
                document.getElementById('author').value='';
                document.getElementById('title').value='';
                document.getElementById('genre').value='';
                document.getElementById('price').value='';

                if(!book.author || !book.title || !book.genre || !book.price )
                {
                    alert("Fill out all the parameters to insert a book into the db");
                    return;
                }
                if(book.price <0.01 || book.price >100)
                {
                    alert("Wrong input in price section it must be between 0.01 and 100");
                    return;
                }
                const xhr = new XMLHttpRequest;
                xhr.open('POST','http://localhost:3000/books',true);
                xhr.setRequestHeader('Content-Type','application/json')
                xhr.send(JSON.stringify(book));
                xhr.onreadystatechange = function()
                {
                    if(xhr.readyState==4)
                    {
                        if(xhr.status==200)
                        {
                            alert(xhr.responseText);
                        }
                        else
                        {
                            alert("Error 404");
                        }
                    }
                };
            });

            document.getElementById('getBooks').addEventListener('click',(event)=>
            {                 
                let key= document.getElementById('searchBook').value;
                document.getElementById('searchBook').value=''; // clear the text box
                document.getElementById('books').innerHTML=''; // clear result section 
                if(!key)
                {
                    alert("Give keyword to search a book!");
                    return;
                }
                const xhr = new XMLHttpRequest;
                url=("http://localhost:3000/books/"+key);
                xhr.open('GET',url,true);
                xhr.send();
                xhr.onreadystatechange = function()
                {
                    if(xhr.readyState==4)
                    {
                        if(xhr.status==200)
                        {   
                            alert("Here are all the matching books found for keyword '"+key+"'")
                            let divElem = document.getElementById('books');
                            const result = JSON.parse(xhr.responseText);
                            result.forEach((item)=>
                            {
                                divElem.innerHTML+=`${item.id}|${item.author}|${item.title}|${item.genre}|${item.price}<br>`;
                            });
                        }
                    }
                };
            });
        });
    </script>
</html>